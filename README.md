# Hub Delivery Service

Early Express ë¬¼ë¥˜ í”Œë«í¼ì˜ **í—ˆë¸Œ ê°„ ë°°ì†¡ ê´€ë¦¬ ì„œë¹„ìŠ¤**ì…ë‹ˆë‹¤. ì¶œë°œ í—ˆë¸Œì—ì„œ ë„ì°© í—ˆë¸Œê¹Œì§€ì˜ ë‹¤ì¤‘ êµ¬ê°„ ë°°ì†¡ì„ ê´€ë¦¬í•˜ë©°, ê° êµ¬ê°„ë³„ ë“œë¼ì´ë²„ ë°°ì • ë° ì‹¤ì‹œê°„ ì§„í–‰ ìƒíƒœë¥¼ ì¶”ì í•©ë‹ˆë‹¤.

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ê¸°ìˆ  ìŠ¤íƒ](#ê¸°ìˆ -ìŠ¤íƒ)
3. [ì•„í‚¤í…ì²˜](#ì•„í‚¤í…ì²˜)
4. [ë„ë©”ì¸ ëª¨ë¸](#ë„ë©”ì¸-ëª¨ë¸)
5. [API ì—”ë“œí¬ì¸íŠ¸](#api-ì—”ë“œí¬ì¸íŠ¸)
6. [Kafka ì´ë²¤íŠ¸](#kafka-ì´ë²¤íŠ¸)
7. [ì„œë¹„ìŠ¤ ì—°ë™](#ì„œë¹„ìŠ¤-ì—°ë™)
8. [í™˜ê²½ ì„¤ì •](#í™˜ê²½-ì„¤ì •)
9. [ì‹¤í–‰ ë°©ë²•](#ì‹¤í–‰-ë°©ë²•)
10. [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°)

---

## ê°œìš”

Hub Delivery ServiceëŠ” í—ˆë¸Œì™€ í—ˆë¸Œ ì‚¬ì´ì˜ ë¬¼ë¥˜ ìš´ì†¡ì„ ê´€ë¦¬í•˜ëŠ” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ì£¼ë¬¸ì˜ ê²½ë¡œ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ì¤‘ êµ¬ê°„ ë°°ì†¡ì„ ìƒì„±í•˜ê³ , ê° êµ¬ê°„ì˜ ì§„í–‰ ìƒíƒœë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ì í•©ë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥

- **ë‹¤ì¤‘ êµ¬ê°„ ë°°ì†¡ ê´€ë¦¬**: ê²½ë¡œìƒì˜ ëª¨ë“  í—ˆë¸Œ êµ¬ê°„ì„ ê°œë³„ì ìœ¼ë¡œ ê´€ë¦¬
- **êµ¬ê°„ë³„ ë“œë¼ì´ë²„ ë°°ì •**: ê° êµ¬ê°„ì— Hub Driver ìë™ ë°°ì •
- **ì‹¤ì‹œê°„ ìƒíƒœ ì¶”ì **: êµ¬ê°„ë³„ ì¶œë°œ/ë„ì°© ì´ë²¤íŠ¸ ë°œí–‰
- **ë°°ì†¡ ì‹œê°„ í†µê³„**: ì˜ˆìƒ ì‹œê°„ vs ì‹¤ì œ ì†Œìš” ì‹œê°„ ë¹„êµ

### ë¬¼ë¥˜ íë¦„ì—ì„œì˜ ìœ„ì¹˜

```
[ì£¼ë¬¸ ìƒì„±] â†’ [Order Service] â†’ [Hub Delivery Service] â†’ [Last Mile Delivery Service] â†’ [ë°°ì†¡ ì™„ë£Œ]
                                         â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         Hub Delivery Service            â”‚
                    â”‚                                         â”‚
                    â”‚  [ì„œìš¸ í—ˆë¸Œ] â”€â”€â†’ [ëŒ€ì „ í—ˆë¸Œ] â”€â”€â†’ [ë¶€ì‚° í—ˆë¸Œ] â”‚
                    â”‚     êµ¬ê°„ 0          êµ¬ê°„ 1               â”‚
                    â”‚                                         â”‚
                    â”‚  â€¢ êµ¬ê°„ë³„ ë“œë¼ì´ë²„ ë°°ì •                   â”‚
                    â”‚  â€¢ ì¶œë°œ/ë„ì°© ì‹œê°„ ê¸°ë¡                    â”‚
                    â”‚  â€¢ ì‹¤ì‹œê°„ ìœ„ì¹˜ ì¶”ì  ì´ë²¤íŠ¸ ë°œí–‰           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ê¸°ìˆ  ìŠ¤íƒ

| êµ¬ë¶„ | ê¸°ìˆ  |
|------|------|
| **Framework** | Spring Boot 3.x |
| **Language** | Java 21 |
| **Database** | PostgreSQL |
| **Messaging** | Apache Kafka |
| **Service Discovery** | Netflix Eureka |
| **Service Communication** | OpenFeign |
| **Security** | OAuth 2.0 Resource Server (Keycloak) |
| **Build Tool** | Gradle |

---

## ì•„í‚¤í…ì²˜

### ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            Hub Delivery Service                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Presentation Layer                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Internal        â”‚ â”‚ Driver          â”‚ â”‚ HubManager      â”‚ â”‚ Master          â”‚   â”‚
â”‚  â”‚ Controller      â”‚ â”‚ Controller      â”‚ â”‚ Controller      â”‚ â”‚ Controller      â”‚   â”‚
â”‚  â”‚ /internal       â”‚ â”‚ /web/drivers    â”‚ â”‚ /web/hub-managerâ”‚ â”‚ /web/master     â”‚   â”‚
â”‚  â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚   â”‚
â”‚  â”‚ â€¢ ë°°ì†¡ ìƒì„±     â”‚ â”‚ â€¢ ë‚´ ë°°ì†¡ ì¡°íšŒ  â”‚ â”‚ â€¢ ìƒíƒœë³„ ì¡°íšŒ   â”‚ â”‚ â€¢ ì „ì²´ ì¡°íšŒ     â”‚   â”‚
â”‚  â”‚ â€¢ êµ¬ê°„ ë°°ì •     â”‚ â”‚ â€¢ ì¶œë°œ ì²˜ë¦¬     â”‚ â”‚                 â”‚ â”‚                 â”‚   â”‚
â”‚  â”‚ â€¢ ë°°ì†¡ ì·¨ì†Œ     â”‚ â”‚ â€¢ ë„ì°© ì²˜ë¦¬     â”‚ â”‚                 â”‚ â”‚                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Application Layer                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  HubDeliveryCommandService   â”‚  â”‚  HubDeliveryQueryService     â”‚                 â”‚
â”‚  â”‚  â€¢ create()                  â”‚  â”‚  â€¢ findAll()                 â”‚                 â”‚
â”‚  â”‚  â€¢ assignDriverForSegment()  â”‚  â”‚  â€¢ findById()                â”‚                 â”‚
â”‚  â”‚  â€¢ departSegment()           â”‚  â”‚  â€¢ findByStatus()            â”‚                 â”‚
â”‚  â”‚  â€¢ arriveSegment()           â”‚  â”‚                              â”‚                 â”‚
â”‚  â”‚  â€¢ cancel()                  â”‚  â”‚                              â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Domain Layer                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  HubDelivery (Aggregate Root)                                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
â”‚  â”‚  â”‚ HubDeliveryId   â”‚  â”‚ HubDeliveryStatus   â”‚  â”‚ List<HubSegment>    â”‚      â”‚    â”‚
â”‚  â”‚  â”‚ (Value Object)  â”‚  â”‚ (Enum)              â”‚  â”‚ (Value Objects)     â”‚      â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
â”‚  â”‚                                                                              â”‚    â”‚
â”‚  â”‚  HubSegment (Value Object)                                                   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚    â”‚
â”‚  â”‚  â”‚ HubSegmentStatus    â”‚                                                     â”‚    â”‚
â”‚  â”‚  â”‚ (Enum)              â”‚                                                     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Infrastructure Layer                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚   PostgreSQL   â”‚ â”‚ Kafka Producer â”‚ â”‚  Feign Client  â”‚                           â”‚
â”‚  â”‚   Repository   â”‚ â”‚ (3 í† í”½ ë°œí–‰)   â”‚ â”‚ (HubDriver)    â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì„œë¹„ìŠ¤ ì—°ë™ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Order Service  â”‚                    â”‚    Hub Delivery Service     â”‚
â”‚                 â”‚â”€â”€â”€â”€â”€ Feign â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                             â”‚
â”‚ (Saga Step)     â”‚  POST /internal/   â”‚  â€¢ HubDelivery ìƒì„±         â”‚
â”‚                 â”‚  deliveries        â”‚  â€¢ HubSegment[] ìƒì„±        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚                             â”‚
                                       â”‚                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚                             â”‚
â”‚  Track Service  â”‚â”€â”€â”€â”€â”€ Feign â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  â€¢ êµ¬ê°„ ë“œë¼ì´ë²„ ë°°ì •       â”‚
â”‚ (ë°°ì†¡ ì¶”ì )      â”‚  POST /internal/   â”‚                             â”‚
â”‚                 â”‚  .../assign-driver â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â”‚ Feign
                                                      â–¼
                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚   Hub Driver Service        â”‚
                                       â”‚                             â”‚
                                       â”‚  â€¢ ë“œë¼ì´ë²„ ìë™ ë°°ì •       â”‚
                                       â”‚  â€¢ ë°°ì†¡ ì™„ë£Œ/ì·¨ì†Œ í†µì§€      â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â”‚ Kafka
                                                      â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                                 â”‚
                    â–¼                                                 â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Track Service  â”‚                              â”‚  Order Service  â”‚
          â”‚                 â”‚                              â”‚                 â”‚
          â”‚ â€¢ êµ¬ê°„ ì¶œë°œ     â”‚                              â”‚ â€¢ í—ˆë¸Œ ë°°ì†¡     â”‚
          â”‚ â€¢ êµ¬ê°„ ë„ì°©     â”‚                              â”‚   ì™„ë£Œ ì²˜ë¦¬     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë„ë©”ì¸ ëª¨ë¸

### HubDelivery (Aggregate Root)

```java
public class HubDelivery {
    // ì‹ë³„ì
    private HubDeliveryId id;             // UUID
    private String orderId;               // ì£¼ë¬¸ ID
    
    // í—ˆë¸Œ ì •ë³´
    private String originHubId;           // ì¶œë°œ í—ˆë¸Œ
    private String destinationHubId;      // ë„ì°© í—ˆë¸Œ
    private String routeInfoJson;         // ê²½ë¡œ ì •ë³´ JSON
    
    // êµ¬ê°„ ì •ë³´
    private List<HubSegment> segments;    // í—ˆë¸Œ êµ¬ê°„ ëª©ë¡
    private Integer currentSegmentIndex;  // í˜„ì¬ ì§„í–‰ ì¤‘ì¸ êµ¬ê°„
    
    // ë“œë¼ì´ë²„ ì •ë³´
    private String driverId;              // í˜„ì¬ ë°°ì •ëœ ë“œë¼ì´ë²„
    
    // ìƒíƒœ
    private HubDeliveryStatus status;
    
    // ì‹œê°„ ì •ë³´
    private LocalDateTime departureDeadline;      // ë°œì†¡ ì‹œí•œ
    private LocalDateTime estimatedArrivalTime;   // ì˜ˆìƒ ë„ì°© ì‹œê°„
    private LocalDateTime startedAt;              // ë°°ì†¡ ì‹œì‘ ì‹œê°„
    private LocalDateTime completedAt;            // ë°°ì†¡ ì™„ë£Œ ì‹œê°„
    
    // í†µê³„
    private Long totalEstimatedDurationMin;       // ì´ ì˜ˆìƒ ì†Œìš” ì‹œê°„
    private Long totalActualDurationMin;          // ì´ ì‹¤ì œ ì†Œìš” ì‹œê°„
    
    // Audit
    private LocalDateTime createdAt;
    private String createdBy;
}
```

### HubSegment (Value Object)

í—ˆë¸Œ ê°„ ì´ë™ì˜ ìµœì†Œ ë‹¨ìœ„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë¶ˆë³€ ê°ì²´ì…ë‹ˆë‹¤.

```java
public class HubSegment {
    private Integer sequence;              // êµ¬ê°„ ìˆœì„œ (0ë¶€í„°)
    private String fromHubId;              // ì¶œë°œ í—ˆë¸Œ
    private String toHubId;                // ë„ì°© í—ˆë¸Œ
    private Long estimatedDistanceM;       // ì˜ˆìƒ ê±°ë¦¬ (m)
    private Long estimatedDurationMin;     // ì˜ˆìƒ ì†Œìš” ì‹œê°„ (ë¶„)
    private String driverId;               // ë°°ì •ëœ ë“œë¼ì´ë²„
    private HubSegmentStatus status;       // êµ¬ê°„ ìƒíƒœ
    private LocalDateTime departedAt;      // ì¶œë°œ ì‹œê°
    private LocalDateTime arrivedAt;       // ë„ì°© ì‹œê°
    private Long actualDurationMin;        // ì‹¤ì œ ì†Œìš” ì‹œê°„ (ë¶„)
}
```

### HubDeliveryStatus (ë°°ì†¡ ìƒíƒœ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           í—ˆë¸Œ ë°°ì†¡ ìƒíƒœ íë¦„ë„                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ë°°ì†¡ ìƒì„±]
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ë“œë¼ì´ë²„ ë°°ì • ì‹œë„    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CREATED   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ WAITING_DRIVER  â”‚
â”‚   ìƒì„±ë¨     â”‚                         â”‚ ë‹´ë‹¹ì ëŒ€ê¸° ì¤‘   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                                 â”‚ ì²« êµ¬ê°„ ì¶œë°œ
                                                 â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚  IN_PROGRESS    â”‚
                                        â”‚  ë°°ì†¡ ì¤‘         â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                            â”‚                            â”‚
                    â–¼                            â–¼                            â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  COMPLETED  â”‚              â”‚   FAILED    â”‚              â”‚  CANCELLED  â”‚
           â”‚  ì™„ë£Œ        â”‚              â”‚   ì‹¤íŒ¨      â”‚              â”‚  ì·¨ì†Œ        â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ìƒíƒœ | ì„¤ëª… | íŠ¹ì§• |
|------|------|------|
| `CREATED` | ìƒì„±ë¨ | ë“œë¼ì´ë²„ ë°°ì • ê°€ëŠ¥ |
| `WAITING_DRIVER` | ë°°ì†¡ ë‹´ë‹¹ì ëŒ€ê¸° ì¤‘ | ë“œë¼ì´ë²„ ë°°ì • ê°€ëŠ¥, ì§„í–‰ ì¤‘ |
| `IN_PROGRESS` | ë°°ì†¡ ì¤‘ | êµ¬ê°„ ì§„í–‰ ì¤‘ |
| `COMPLETED` | ì™„ë£Œ | ì¢…ë£Œ ìƒíƒœ |
| `FAILED` | ì‹¤íŒ¨ | ì¢…ë£Œ ìƒíƒœ |

### HubSegmentStatus (êµ¬ê°„ ìƒíƒœ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           í—ˆë¸Œ êµ¬ê°„ ìƒíƒœ íë¦„ë„                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[êµ¬ê°„ ìƒì„±]
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    assignDriver()    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    depart()    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PENDING   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  ASSIGNED   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ IN_TRANSIT  â”‚
â”‚   ëŒ€ê¸° ì¤‘    â”‚                      â”‚  ë°°ì • ì™„ë£Œ   â”‚                â”‚  ì´ë™ ì¤‘     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚                              â”‚
                                            â”‚                              â”‚ arrive()
                                            â”‚                              â–¼
                                            â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚                       â”‚   ARRIVED   â”‚
                                            â”‚                       â”‚   ë„ì°©       â”‚
                                            â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚                              â”‚
                                            â”‚ fail()                       â”‚ fail()
                                            â–¼                              â–¼
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚   FAILED    â”‚              â”‚   FAILED    â”‚
                                     â”‚   ì‹¤íŒ¨       â”‚              â”‚   ì‹¤íŒ¨       â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ìƒíƒœ | ì„¤ëª… | ë°°ì • ê°€ëŠ¥ | ì¶œë°œ ê°€ëŠ¥ | ë„ì°© ê°€ëŠ¥ |
|------|------|----------|----------|----------|
| `PENDING` | ëŒ€ê¸° ì¤‘ (ë“œë¼ì´ë²„ ë¯¸ë°°ì •) | âœ… | âŒ | âŒ |
| `ASSIGNED` | ë°°ì • ì™„ë£Œ | âŒ | âœ… | âŒ |
| `IN_TRANSIT` | ì´ë™ ì¤‘ | âŒ | âŒ | âœ… |
| `ARRIVED` | ë„ì°© | âŒ | âŒ | âŒ |
| `FAILED` | ì‹¤íŒ¨ | âŒ | âŒ | âŒ |

---

## API ì—”ë“œí¬ì¸íŠ¸

### Internal API (ë‚´ë¶€ ì„œë¹„ìŠ¤ ê°„ í†µì‹ )

**Base Path**: `/v1/hub-delivery/internal`

> âš ï¸ ì´ APIëŠ” ë‚´ë¶€ ì„œë¹„ìŠ¤ ê°„ í†µì‹ ìš©ì…ë‹ˆë‹¤. Gatewayë¥¼ í†µí•´ ì™¸ë¶€ì— ë…¸ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

| Method | Endpoint | ì„¤ëª… | í˜¸ì¶œ ì„œë¹„ìŠ¤ |
|--------|----------|------|-------------|
| `POST` | `/deliveries` | í—ˆë¸Œ ë°°ì†¡ ìƒì„± | Order Service |
| `POST` | `/deliveries/{id}/segments/{index}/assign-driver` | êµ¬ê°„ ë“œë¼ì´ë²„ ë°°ì • | Track Service |
| `POST` | `/deliveries/{id}/cancel` | ë°°ì†¡ ì·¨ì†Œ | Order Service |

#### í—ˆë¸Œ ë°°ì†¡ ìƒì„±

Order Sagaì—ì„œ í—ˆë¸Œ ë°°ì†¡ Step ì‹¤í–‰ ì‹œ í˜¸ì¶œë©ë‹ˆë‹¤.

```http
POST /v1/hub-delivery/internal/deliveries
X-User-Id: system
Content-Type: application/json
```

**Request**
```json
{
  "orderId": "order-uuid-001",
  "originHubId": "hub-seoul-001",
  "destinationHubId": "hub-busan-001",
  "routeHubs": ["hub-seoul-001", "hub-daejeon-001", "hub-busan-001"],
  "routeInfoJson": "{\"totalDistance\":450000,\"segments\":[...]}",
  "departureDeadline": "2025-01-19T18:00:00",
  "estimatedArrivalTime": "2025-01-20T13:30:00"
}
```

**Response (200 OK)**
```json
{
  "hubDeliveryId": "hub-delivery-uuid-001",
  "orderId": "order-uuid-001",
  "status": "CREATED",
  "message": "í—ˆë¸Œ ë°°ì†¡ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

**ìƒì„± ë¡œì§**:
1. `HubDelivery` ìƒì„± (ìƒíƒœ: `CREATED`)
2. `routeHubs`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ `HubSegment[]` ìƒì„±
    - êµ¬ê°„ 0: hub-seoul-001 â†’ hub-daejeon-001
    - êµ¬ê°„ 1: hub-daejeon-001 â†’ hub-busan-001
3. ê° êµ¬ê°„ ìƒíƒœ: `PENDING`

---

#### êµ¬ê°„ ë“œë¼ì´ë²„ ë°°ì •

Track Serviceì—ì„œ ë°°ì†¡ ì¶”ì  ì‹œì‘ ì‹œ ê° êµ¬ê°„ì— ë“œë¼ì´ë²„ë¥¼ ë°°ì •í•©ë‹ˆë‹¤.

```http
POST /v1/hub-delivery/internal/deliveries/{hubDeliveryId}/segments/{segmentIndex}/assign-driver
X-User-Id: system
```

**Response (200 OK)**
```json
{
  "hubDeliveryId": "hub-delivery-uuid-001",
  "segmentIndex": 0,
  "driverId": "hub-driver-001",
  "driverName": "ë°•í—ˆë¸Œ",
  "status": "ASSIGNED",
  "success": true,
  "message": "ë“œë¼ì´ë²„ê°€ ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

**ì²˜ë¦¬ ë¡œì§**:
1. Hub Driver Serviceì— ë“œë¼ì´ë²„ ë°°ì • ìš”ì²­ (Feign)
2. í•´ë‹¹ êµ¬ê°„ ìƒíƒœ: `PENDING` â†’ `ASSIGNED`
3. `driverId` ì €ì¥

---

#### ë°°ì†¡ ì·¨ì†Œ (ë³´ìƒ íŠ¸ëœì­ì…˜)

Order Saga ë³´ìƒ íŠ¸ëœì­ì…˜ì—ì„œ í˜¸ì¶œë©ë‹ˆë‹¤.

```http
POST /v1/hub-delivery/internal/deliveries/{hubDeliveryId}/cancel
X-User-Id: system
```

**Response (200 OK)**
```json
{
  "hubDeliveryId": "hub-delivery-uuid-001",
  "orderId": "order-uuid-001",
  "status": "FAILED",
  "message": "í—ˆë¸Œ ë°°ì†¡ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

**ì²˜ë¦¬ ë¡œì§**:
1. ë°°ì •ëœ ë“œë¼ì´ë²„ë“¤ì—ê²Œ ì·¨ì†Œ í†µì§€ (Hub Driver Service)
2. ë°°ì†¡ ìƒíƒœ: `FAILED`

---

### Driver API (ë°°ì†¡ ë‹´ë‹¹ììš©)

**Base Path**: `/v1/hub-delivery/web/drivers`

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| `GET` | `/deliveries/{id}` | ë‚´ ë°°ì†¡ ìƒì„¸ ì¡°íšŒ |
| `PUT` | `/deliveries/{id}/segments/{index}/depart` | êµ¬ê°„ ì¶œë°œ ì²˜ë¦¬ |
| `PUT` | `/deliveries/{id}/segments/{index}/arrive` | êµ¬ê°„ ë„ì°© ì²˜ë¦¬ |

#### ë‚´ ë°°ì†¡ ìƒì„¸ ì¡°íšŒ

```http
GET /v1/hub-delivery/web/drivers/deliveries/{hubDeliveryId}
X-User-Id: hub-driver-001
X-User-Roles: DRIVER
```

**Response (200 OK)**
```json
{
  "success": true,
  "data": {
    "hubDeliveryId": "hub-delivery-uuid-001",
    "orderId": "order-uuid-001",
    "status": "IN_PROGRESS",
    "currentSegmentIndex": 0,
    "totalSegments": 2,
    "completedSegments": 0,
    "startedAt": "2025-01-15T10:30:00",
    "segments": [
      {
        "sequence": 0,
        "fromHubId": "hub-seoul-001",
        "toHubId": "hub-daejeon-001",
        "status": "IN_TRANSIT",
        "departedAt": "2025-01-15T10:30:00",
        "arrivedAt": null,
        "estimatedDurationMin": 120,
        "actualDurationMin": null
      },
      {
        "sequence": 1,
        "fromHubId": "hub-daejeon-001",
        "toHubId": "hub-busan-001",
        "status": "PENDING",
        "departedAt": null,
        "arrivedAt": null,
        "estimatedDurationMin": 150,
        "actualDurationMin": null
      }
    ]
  }
}
```

---

#### êµ¬ê°„ ì¶œë°œ ì²˜ë¦¬

```http
PUT /v1/hub-delivery/web/drivers/deliveries/{hubDeliveryId}/segments/{segmentIndex}/depart
X-User-Id: hub-driver-001
X-User-Roles: DRIVER
```

**Response (200 OK)**
```json
{
  "success": true,
  "data": null,
  "message": "êµ¬ê°„ ì¶œë°œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

**ì²˜ë¦¬ ë¡œì§**:
1. êµ¬ê°„ ìƒíƒœ: `ASSIGNED` â†’ `IN_TRANSIT`
2. `departedAt` ê¸°ë¡
3. ì²« êµ¬ê°„ ì¶œë°œ ì‹œ ë°°ì†¡ ìƒíƒœ: `WAITING_DRIVER` â†’ `IN_PROGRESS`
4. **Kafka ì´ë²¤íŠ¸ ë°œí–‰**: `HubSegmentDepartedEvent` â†’ Track Service

---

#### êµ¬ê°„ ë„ì°© ì²˜ë¦¬

```http
PUT /v1/hub-delivery/web/drivers/deliveries/{hubDeliveryId}/segments/{segmentIndex}/arrive
X-User-Id: hub-driver-001
X-User-Roles: DRIVER
```

**Response (200 OK)**
```json
{
  "success": true,
  "data": null,
  "message": "êµ¬ê°„ ë„ì°© ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

**ì²˜ë¦¬ ë¡œì§**:
1. êµ¬ê°„ ìƒíƒœ: `IN_TRANSIT` â†’ `ARRIVED`
2. `arrivedAt` ê¸°ë¡
3. `actualDurationMin` ê³„ì‚° (ë„ì°©ì‹œê°„ - ì¶œë°œì‹œê°„)
4. Hub Driver Serviceì— ë°°ì†¡ ì™„ë£Œ í†µì§€ (í†µê³„ ì—…ë°ì´íŠ¸)
5. **Kafka ì´ë²¤íŠ¸ ë°œí–‰**: `HubSegmentArrivedEvent` â†’ Track Service
6. ë§ˆì§€ë§‰ êµ¬ê°„ ë„ì°© ì‹œ:
    - ë°°ì†¡ ìƒíƒœ: `IN_PROGRESS` â†’ `COMPLETED`
    - `completedAt`, `totalActualDurationMin` ê¸°ë¡
    - **Kafka ì´ë²¤íŠ¸ ë°œí–‰**: `HubDeliveryCompletedEvent` â†’ Order Service

---

### Hub Manager API (í—ˆë¸Œ ê´€ë¦¬ììš©)

**Base Path**: `/v1/hub-delivery/web/hub-manager`

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| `GET` | `/deliveries` | ìƒíƒœë³„ ë°°ì†¡ ëª©ë¡ ì¡°íšŒ |

#### ìƒíƒœë³„ ë°°ì†¡ ëª©ë¡ ì¡°íšŒ

```http
GET /v1/hub-delivery/web/hub-manager/deliveries?status=IN_PROGRESS
X-User-Id: hub-manager-001
X-User-Roles: HUB_MANAGER
```

**Query Parameters**

| íŒŒë¼ë¯¸í„° | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|---------|------|------|------|
| `status` | Enum | âŒ | ë°°ì†¡ ìƒíƒœ í•„í„° |
| `page` | Integer | âŒ | í˜ì´ì§€ ë²ˆí˜¸ (ê¸°ë³¸ê°’: 0) |
| `size` | Integer | âŒ | í˜ì´ì§€ í¬ê¸° (ê¸°ë³¸ê°’: 20) |

**Response (200 OK)**
```json
{
  "success": true,
  "data": {
    "content": [
      {
        "hubDeliveryId": "hub-delivery-uuid-001",
        "orderId": "order-uuid-001",
        "originHubId": "hub-seoul-001",
        "destinationHubId": "hub-busan-001",
        "status": "IN_PROGRESS",
        "driverId": "hub-driver-001",
        "currentSegmentIndex": 0,
        "totalSegments": 2,
        "completedSegments": 0,
        "startedAt": "2025-01-15T10:30:00",
        "createdAt": "2025-01-15T10:00:00"
      }
    ],
    "pageInfo": {
      "page": 0,
      "size": 20,
      "totalElements": 15,
      "totalPages": 1
    }
  }
}
```

---

### Master API (ë§ˆìŠ¤í„° ê´€ë¦¬ììš©)

**Base Path**: `/v1/hub-delivery/web/master`

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| `GET` | `/deliveries` | ì „ì²´ ë°°ì†¡ ëª©ë¡ ì¡°íšŒ |

#### ì „ì²´ ë°°ì†¡ ëª©ë¡ ì¡°íšŒ

```http
GET /v1/hub-delivery/web/master/deliveries?status=COMPLETED
X-User-Id: master-001
X-User-Roles: MASTER
```

**Response (200 OK)**
```json
{
  "success": true,
  "data": {
    "content": [
      {
        "hubDeliveryId": "hub-delivery-uuid-001",
        "orderId": "order-uuid-001",
        "originHubId": "hub-seoul-001",
        "destinationHubId": "hub-busan-001",
        "status": "COMPLETED",
        "driverId": "hub-driver-001",
        "currentSegmentIndex": 1,
        "totalSegments": 2,
        "completedSegments": 2,
        "startedAt": "2025-01-15T10:30:00",
        "completedAt": "2025-01-15T15:00:00",
        "totalEstimatedDurationMin": 270,
        "totalActualDurationMin": 270,
        "createdAt": "2025-01-15T10:00:00"
      }
    ],
    "pageInfo": {
      "page": 0,
      "size": 20,
      "totalElements": 100,
      "totalPages": 5
    }
  }
}
```

**Master vs Hub Manager ì‘ë‹µ ì°¨ì´**

| í•„ë“œ | Hub Manager | Master |
|------|-------------|--------|
| `completedAt` | âŒ | âœ… |
| `totalEstimatedDurationMin` | âŒ | âœ… |
| `totalActualDurationMin` | âŒ | âœ… |

---

## Kafka ì´ë²¤íŠ¸

### ì´ë²¤íŠ¸ íë¦„ë„

```
                              Hub Delivery Service
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                          â”‚
                    â”‚   êµ¬ê°„ ì¶œë°œ ì‹œ                            â”‚
                    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚   â”‚  TrackEventProducer                â”‚ â”‚
                    â”‚   â”‚  publishSegmentDeparted()          â”‚â”€â”¼â”€â”€â”€â”€â–¶ hub-segment-departed
                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         (â†’ Track Service)
                    â”‚                                          â”‚
                    â”‚   êµ¬ê°„ ë„ì°© ì‹œ                            â”‚
                    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚   â”‚  TrackEventProducer                â”‚ â”‚
                    â”‚   â”‚  publishSegmentArrived()           â”‚â”€â”¼â”€â”€â”€â”€â–¶ hub-segment-arrived
                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         (â†’ Track Service)
                    â”‚                                          â”‚
                    â”‚   í—ˆë¸Œ ë°°ì†¡ ì™„ë£Œ ì‹œ                       â”‚
                    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚   â”‚  OrderEventProducer                â”‚ â”‚
                    â”‚   â”‚  publishHubDeliveryCompleted()     â”‚â”€â”¼â”€â”€â”€â”€â–¶ hub-delivery-completed
                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         (â†’ Order Service)
                    â”‚                                          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°œí–‰ ì´ë²¤íŠ¸

#### 1. hub-segment-departed (â†’ Track Service)

êµ¬ê°„ ì¶œë°œ ì‹œ ë°œí–‰ë©ë‹ˆë‹¤.

**í† í”½**: `hub-segment-departed`

```json
{
  "eventId": "evt-uuid-001",
  "eventType": "HUB_SEGMENT_DEPARTED",
  "source": "hub-delivery-service",
  "timestamp": "2025-01-15T10:30:00",
  "orderId": "order-uuid-001",
  "hubDeliveryId": "hub-delivery-uuid-001",
  "segmentIndex": 0,
  "fromHubId": "hub-seoul-001",
  "toHubId": "hub-daejeon-001",
  "departedAt": "2025-01-15T10:30:00"
}
```

---

#### 2. hub-segment-arrived (â†’ Track Service)

êµ¬ê°„ ë„ì°© ì‹œ ë°œí–‰ë©ë‹ˆë‹¤.

**í† í”½**: `hub-segment-arrived`

```json
{
  "eventId": "evt-uuid-002",
  "eventType": "HUB_SEGMENT_ARRIVED",
  "source": "hub-delivery-service",
  "timestamp": "2025-01-15T12:30:00",
  "orderId": "order-uuid-001",
  "hubDeliveryId": "hub-delivery-uuid-001",
  "segmentIndex": 0,
  "hubId": "hub-daejeon-001",
  "arrivedAt": "2025-01-15T12:30:00"
}
```

---

#### 3. hub-delivery-completed (â†’ Order Service)

ëª¨ë“  êµ¬ê°„ ì™„ë£Œ ì‹œ ë°œí–‰ë©ë‹ˆë‹¤.

**í† í”½**: `hub-delivery-completed`

```json
{
  "eventId": "evt-uuid-003",
  "eventType": "HUB_DELIVERY_COMPLETED",
  "source": "hub-delivery-service",
  "timestamp": "2025-01-15T15:00:00",
  "orderId": "order-uuid-001",
  "hubDeliveryId": "hub-delivery-uuid-001",
  "completedAt": "2025-01-15T15:00:00",
  "totalActualDurationMin": 270
}
```

---

## ì„œë¹„ìŠ¤ ì—°ë™

### Feign Client (Hub Driver Service)

```java
@FeignClient(name = "hub-driver-service")
public interface HubDriverClient {
    
    @PostMapping("/v1/hub-driver/internal/drivers/assign")
    DriverAssignResponse assignDriver(@RequestBody DriverAssignRequest request);
    
    @PutMapping("/v1/hub-driver/internal/drivers/{driverId}/complete")
    DriverOperationResponse completeDelivery(
            @PathVariable String driverId,
            @RequestBody DriverCompleteRequest request);
    
    @PutMapping("/v1/hub-driver/internal/drivers/{driverId}/cancel")
    DriverOperationResponse cancelDelivery(@PathVariable String driverId);
}
```

### ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

#### í—ˆë¸Œ ë°°ì†¡ ìƒì„± ë° ì§„í–‰ í”Œë¡œìš°

```
Order Service        Hub Delivery Service       Hub Driver Service       Track Service
     â”‚                       â”‚                         â”‚                       â”‚
     â”‚  POST /deliveries     â”‚                         â”‚                       â”‚
     â”‚  {orderId, route}     â”‚                         â”‚                       â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                         â”‚                       â”‚
     â”‚                       â”‚ HubDelivery ìƒì„±        â”‚                       â”‚
     â”‚                       â”‚ HubSegment[] ìƒì„±       â”‚                       â”‚
     â”‚   {hubDeliveryId}     â”‚                         â”‚                       â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚                       â”‚
     â”‚                       â”‚                         â”‚                       â”‚
     â”‚                       â”‚                         â”‚                       â”‚
     â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                       â”‚  POST .../assign-driver â”‚                       â”‚ Trackì—ì„œ
     â”‚                       â”‚                         â”‚                       â”‚ ë°°ì • ìš”ì²­
     â”‚                       â”‚  POST /drivers/assign   â”‚                       â”‚
     â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                       â”‚
     â”‚                       â”‚   {driverId, name}      â”‚                       â”‚
     â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
     â”‚                       â”‚                         â”‚                       â”‚
     â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                       â”‚   {driverId, success}   â”‚                       â”‚
     â”‚                       â”‚                         â”‚                       â”‚
     â”‚                       â”‚                         â”‚                       â”‚
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                           [ë“œë¼ì´ë²„ê°€ ì¶œë°œ ì²˜ë¦¬]
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     â”‚                       â”‚                         â”‚                       â”‚
     â”‚                       â”‚  PUT .../depart         â”‚                       â”‚
     â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
     â”‚                       â”‚                         â”‚ Driver Appì—ì„œ í˜¸ì¶œ    â”‚
     â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
     â”‚                       â”‚  Kafka: hub-segment-departed                    â”‚
     â”‚                       â”‚                         â”‚                       â”‚
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                           [ë“œë¼ì´ë²„ê°€ ë„ì°© ì²˜ë¦¬]
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     â”‚                       â”‚                         â”‚                       â”‚
     â”‚                       â”‚  PUT .../arrive         â”‚                       â”‚
     â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
     â”‚                       â”‚                         â”‚                       â”‚
     â”‚                       â”‚  PUT /drivers/{}/complete                       â”‚
     â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                       â”‚
     â”‚                       â”‚   {AVAILABLE}           â”‚                       â”‚
     â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
     â”‚                       â”‚                         â”‚                       â”‚
     â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
     â”‚                       â”‚  Kafka: hub-segment-arrived                     â”‚
     â”‚                       â”‚                         â”‚                       â”‚
     â”‚                       â”‚                         â”‚                       â”‚
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                      [ë§ˆì§€ë§‰ êµ¬ê°„ ë„ì°© ì‹œ - ë°°ì†¡ ì™„ë£Œ]
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     â”‚                       â”‚                         â”‚                       â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚                       â”‚
     â”‚  Kafka: hub-delivery-completed                  â”‚                       â”‚
     â”‚                       â”‚                         â”‚                       â”‚
```

---

## í™˜ê²½ ì„¤ì •

### í™˜ê²½ ë³€ìˆ˜ (.env)

```properties
# ì„œë²„ ì„¤ì •
APP_PORT=4030

# ë°ì´í„°ë² ì´ìŠ¤
SPRING_DATASOURCE_URL=jdbc:postgresql://localhost:5432/hub_delivery_db
SPRING_DATASOURCE_USERNAME=postgres
SPRING_DATASOURCE_PASSWORD=password

# Eureka
EUREKA_DEFAULT_ZONE=http://localhost:8761/eureka/

# Kafka
KAFKA_BOOTSTRAP_SERVERS=localhost:9092

# Keycloak
KEYCLOAK_ISSUER_URI=http://localhost:8080/realms/early-express

# Kafka Topics
SPRING_KAFKA_TOPIC_HUB_SEGMENT_DEPARTED=hub-segment-departed
SPRING_KAFKA_TOPIC_HUB_SEGMENT_ARRIVED=hub-segment-arrived
SPRING_KAFKA_TOPIC_HUB_DELIVERY_COMPLETED=hub-delivery-completed

# Feign Client
CLIENT_HUB_DRIVER_SERVICE_URL=http://hub-driver-service
```

### application.yml ì£¼ìš” ì„¤ì •

```yaml
spring:
  application:
    name: hub-delivery-service
  
  kafka:
    producer:
      acks: all
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer

client:
  hub-driver-service:
    url: ${CLIENT_HUB_DRIVER_SERVICE_URL}

eureka:
  client:
    service-url:
      defaultZone: ${EUREKA_DEFAULT_ZONE}
```

---

## ì‹¤í–‰ ë°©ë²•

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

- Java 21
- PostgreSQL 15+
- Apache Kafka
- Eureka Server
- Keycloak
- Hub Driver Service

### ë¡œì»¬ ì‹¤í–‰

```bash
# 1. ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
createdb hub_delivery_db

# 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
export $(cat .env | xargs)

# 3. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
./gradlew bootRun
```

### Docker ì‹¤í–‰

```bash
docker-compose up -d hub-delivery-service
```

### Health Check

```bash
curl http://localhost:4030/actuator/health
```

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/main/java/com/early_express/hub_delivery_service/
â”œâ”€â”€ domain/hub_delivery/
â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â”œâ”€â”€ event/
â”‚   â”‚   â”‚   â””â”€â”€ HubDeliveryEventPublisher.java
â”‚   â”‚   â””â”€â”€ service/
â”‚   â”‚       â”œâ”€â”€ command/
â”‚   â”‚       â”‚   â”œâ”€â”€ HubDeliveryCommandService.java
â”‚   â”‚       â”‚   â””â”€â”€ dto/
â”‚   â”‚       â”‚       â””â”€â”€ HubDeliveryCommandDto.java
â”‚   â”‚       â”‚           â”œâ”€â”€ CreateCommand / CreateResult
â”‚   â”‚       â”‚           â”œâ”€â”€ AssignDriverForSegmentCommand / AssignDriverResult
â”‚   â”‚       â”‚           â”œâ”€â”€ DepartSegmentCommand
â”‚   â”‚       â”‚           â”œâ”€â”€ ArriveSegmentCommand
â”‚   â”‚       â”‚           â””â”€â”€ CancelCommand
â”‚   â”‚       â””â”€â”€ query/
â”‚   â”‚           â”œâ”€â”€ HubDeliveryQueryService.java
â”‚   â”‚           â””â”€â”€ dto/
â”‚   â”‚               â””â”€â”€ HubDeliveryQueryDto.java
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ exception/
â”‚   â”‚   â”‚   â”œâ”€â”€ HubDeliveryErrorCode.java
â”‚   â”‚   â”‚   â””â”€â”€ HubDeliveryException.java
â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”‚   â”œâ”€â”€ HubDelivery.java              # Aggregate Root
â”‚   â”‚   â”‚   â””â”€â”€ vo/
â”‚   â”‚   â”‚       â”œâ”€â”€ HubDeliveryId.java
â”‚   â”‚   â”‚       â”œâ”€â”€ HubDeliveryStatus.java
â”‚   â”‚   â”‚       â”œâ”€â”€ HubSegment.java           # Value Object
â”‚   â”‚   â”‚       â””â”€â”€ HubSegmentStatus.java
â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚       â””â”€â”€ HubDeliveryRepository.java
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/
â”‚   â”‚   â”œâ”€â”€ client/
â”‚   â”‚   â”‚   â””â”€â”€ hub_driver/
â”‚   â”‚   â”‚       â”œâ”€â”€ HubDriverClient.java
â”‚   â”‚   â”‚       â”œâ”€â”€ HubDriverClientConfig.java
â”‚   â”‚   â”‚       â”œâ”€â”€ HubDriverErrorDecoder.java
â”‚   â”‚   â”‚       â””â”€â”€ dto/
â”‚   â”‚   â”‚           â”œâ”€â”€ DriverAssignRequest.java
â”‚   â”‚   â”‚           â”œâ”€â”€ DriverAssignResponse.java
â”‚   â”‚   â”‚           â”œâ”€â”€ DriverCompleteRequest.java
â”‚   â”‚   â”‚           â””â”€â”€ DriverOperationResponse.java
â”‚   â”‚   â”œâ”€â”€ messaging/
â”‚   â”‚   â”‚   â”œâ”€â”€ HubDeliveryEventPublisherImpl.java
â”‚   â”‚   â”‚   â”œâ”€â”€ order/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ event/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ HubDeliveryCompletedEvent.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ producer/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ OrderEventProducer.java
â”‚   â”‚   â”‚   â””â”€â”€ track/
â”‚   â”‚   â”‚       â”œâ”€â”€ event/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ HubSegmentDepartedEvent.java
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ HubSegmentArrivedEvent.java
â”‚   â”‚   â”‚       â””â”€â”€ producer/
â”‚   â”‚   â”‚           â””â”€â”€ TrackEventProducer.java
â”‚   â”‚   â””â”€â”€ persistence/
â”‚   â”‚       â”œâ”€â”€ HubDeliveryEntity.java
â”‚   â”‚       â”œâ”€â”€ HubSegmentEmbeddable.java
â”‚   â”‚       â”œâ”€â”€ HubDeliveryJpaRepository.java
â”‚   â”‚       â””â”€â”€ HubDeliveryRepositoryImpl.java
â”‚   â”‚
â”‚   â””â”€â”€ presentation/
â”‚       â”œâ”€â”€ internal/
â”‚       â”‚   â”œâ”€â”€ HubDeliveryInternalController.java
â”‚       â”‚   â””â”€â”€ dto/
â”‚       â”‚       â”œâ”€â”€ request/
â”‚       â”‚       â”‚   â”œâ”€â”€ HubDeliveryCreateRequest.java
â”‚       â”‚       â”‚   â””â”€â”€ AssignDriverForSegmentRequest.java
â”‚       â”‚       â””â”€â”€ response/
â”‚       â”‚           â”œâ”€â”€ HubDeliveryCreateResponse.java
â”‚       â”‚           â””â”€â”€ AssignDriverForSegmentResponse.java
â”‚       â””â”€â”€ web/
â”‚           â”œâ”€â”€ driver/
â”‚           â”‚   â”œâ”€â”€ HubDeliveryDriverController.java
â”‚           â”‚   â””â”€â”€ dto/response/
â”‚           â”‚       â””â”€â”€ DriverHubDeliveryResponse.java
â”‚           â”œâ”€â”€ hubmanager/
â”‚           â”‚   â”œâ”€â”€ HubDeliveryHubManagerController.java
â”‚           â”‚   â””â”€â”€ dto/response/
â”‚           â”‚       â””â”€â”€ HubManagerHubDeliveryResponse.java
â”‚           â””â”€â”€ master/
â”‚               â”œâ”€â”€ HubDeliveryMasterController.java
â”‚               â””â”€â”€ dto/response/
â”‚                   â””â”€â”€ MasterHubDeliveryResponse.java
â”‚
â””â”€â”€ global/
    â”œâ”€â”€ common/dto/
    â”‚   â””â”€â”€ PageInfo.java
    â””â”€â”€ presentation/dto/
        â”œâ”€â”€ ApiResponse.java
        â””â”€â”€ PageResponse.java
```

---

## ì—ëŸ¬ ì½”ë“œ

| ì—ëŸ¬ ì½”ë“œ | HTTP Status | ì„¤ëª… |
|----------|-------------|------|
| `HUB_DELIVERY_NOT_FOUND` | 404 | í—ˆë¸Œ ë°°ì†¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ |
| `SEGMENT_NOT_FOUND` | 404 | êµ¬ê°„ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ |
| `SEGMENT_CANNOT_ASSIGN` | 400 | êµ¬ê°„ì— ë“œë¼ì´ë²„ë¥¼ ë°°ì •í•  ìˆ˜ ì—†ìŒ |
| `SEGMENT_ALREADY_DEPARTED` | 400 | ì´ë¯¸ ì¶œë°œí•œ êµ¬ê°„ |
| `SEGMENT_ALREADY_ARRIVED` | 400 | ì´ë¯¸ ë„ì°©í•œ êµ¬ê°„ |
| `DRIVER_NOT_ASSIGNED` | 400 | ë“œë¼ì´ë²„ê°€ ë°°ì •ë˜ì§€ ì•ŠìŒ |
| `INVALID_SEGMENT_STATUS` | 400 | ì˜ëª»ëœ êµ¬ê°„ ìƒíƒœ |

---

## ë³´ì•ˆ

- **OAuth 2.0 Resource Server**: Keycloak JWT í† í° ê²€ì¦
- **ì—­í• ë³„ ì ‘ê·¼ ì œì–´**:
    - Internal API: ì„œë¹„ìŠ¤ ê°„ í†µì‹ ë§Œ í—ˆìš© (Gateway ë¯¸ë…¸ì¶œ)
    - Driver API: `DRIVER` ì—­í•  í•„ìš”
    - Hub Manager API: `HUB_MANAGER` ì—­í•  í•„ìš”
    - Master API: `MASTER` ì—­í•  í•„ìš”

---

## ëª¨ë‹ˆí„°ë§

- **Actuator**: `/actuator/health`, `/actuator/info`
- **ì£¼ìš” ë©”íŠ¸ë¦­**:
    - ë°°ì†¡ë³„ ì˜ˆìƒ ì‹œê°„ vs ì‹¤ì œ ì†Œìš” ì‹œê°„
    - êµ¬ê°„ë³„ í‰ê·  ì†Œìš” ì‹œê°„
    - ì¼ë³„ í—ˆë¸Œ ë°°ì†¡ ì™„ë£Œ ê±´ìˆ˜

---

## ê´€ë ¨ ì„œë¹„ìŠ¤

| ì„œë¹„ìŠ¤ | ì—°ë™ ë°©ì‹ | ì—­í•  |
|--------|----------|------|
| **Order Service** | Feign (í˜¸ì¶œë°›ìŒ) + Kafka | í—ˆë¸Œ ë°°ì†¡ ìƒì„±/ì·¨ì†Œ, ì™„ë£Œ ì´ë²¤íŠ¸ ìˆ˜ì‹  |
| **Track Service** | Feign (í˜¸ì¶œë°›ìŒ) + Kafka | êµ¬ê°„ ë“œë¼ì´ë²„ ë°°ì •, ì¶œë°œ/ë„ì°© ì´ë²¤íŠ¸ ìˆ˜ì‹  |
| **Hub Driver Service** | Feign (í˜¸ì¶œ) | ë“œë¼ì´ë²„ ë°°ì •/ì™„ë£Œ/ì·¨ì†Œ |